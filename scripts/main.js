$(function(){var o,t=$("#search_btn"),e=Ladda.create(t[0]),n=$("#search_input"),a=$("#bookshelf"),s=14,r=6,i=0,c=$("#detailsModal").modal({show:!1}),d=function(o){c.find("#details_header").text(o.title),c.find("#details_author").text((o.author_name?o.author_name:"No author found")+", "+(o.publish_date?o.publish_date:"no date found")),"string"==typeof o.subject&&(o.subject=[o.subject]);var t=c.find("#details_subjects").empty();o.subject.forEach(function(o){t.append($("<li class='btn btn-info btn-sm'>").append($("<a href='#'>").text(o).click(function(){console.log("searching subject ",o),p(o)})))}),c.modal("show")},u=function(o){var t=!1;a.empty(),"undefined"==typeof o[0]&&(console.log(o),o=[o]),o.forEach(function(o){if(o.subject){var e=$("<div>").addClass("book").addClass("book-color-"+Math.floor(Math.random()*s)).addClass("book-height-"+Math.floor(Math.random()*r)).tooltip({placement:"bottom",title:o.title}).click(function(){d(o)}),n=$("<h2>").text(o.title);o.title.length>18&&n.addClass("long-title"),o.title.length>26&&n.text(o.title.substr(0,26)+"..."),console.log(o.title),console.log(o),e.append(n),Math.random()<.1&&!t?(e=$("<div>").addClass("book-tilted").append(e),t=!0):t=!1,a.append(e)}})},f=function(o){return"https://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20json%20where%20url%3D'"+encodeURI("http://openlibrary.org/search.json?q="+encodeURIComponent(o.replace(/\'/gi,"")))+"'&format=json&callback=?"},h=function(o,t){return"https://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20json%20where%20url%3D'"+encodeURI("http://openlibrary.org/subjects/"+encodeURIComponent(o.toLowerCase())+".json?limit=50"+(t?"&offset="+t:""))+"'&format=json&callback=?"},p=function(t,a){var s=h(t,a);n.val(t),e.start(),c.modal("hide"),$.getJSON(s,function(o){return e.stop(),o.query.results?void u(o.query.results.json.works):void $("#errorModal").modal("show")}).fail(function(){$("#errorModal").modal("show"),l.stop()}),i=a,o=t};t.click(function(){var o=n.val();e.start();var t=f(o);$.getJSON(t,function(o){return e.stop(),o.query.results?void u(o.query.results.json.docs):void $("#errorModal").modal("show")}).fail(function(){$("#errorModal").modal("show"),e.stop()})}),n.on("keyup",function(o){13===o.keyCode&&t.click()})});